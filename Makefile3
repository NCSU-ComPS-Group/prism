# Makefile for compiling myproject

# Compiler settings
CXX = g++
CXXFLAGS = -std=c++20 -g -Wall -Wextra
# external libraries that are needed
YAML_LINK = -lyaml-cpp
FMT_LINK = -lfmt
# Source file and executable name
SRC = main.cpp
EXE = myproject_executable
LIB_NAME = myproject
LIB_VERSION = 1.0
LIB = lib$(LIB_NAME).so.$(LIB_VERSION)
DATA = *.bin

# Directories
SRCDIR = src
INCDIR = include
BUILDDIR = build
BINDIR = bin

# Source and header files
SOURCES = $(wildcard $(SRCDIR)/*.cpp)
HEADERS = $(wildcard $(INCDIR)/*.h)
LIB_OBJECTS = $(patsyubst $(SRCDIR)/%.cpp, $(BUILDDIR)/%.o, $(SOURCES))

# Include all headers for the library
LIB_INCLUDES = -I$(INCDIR)

# build the library
$(LIB): $(LIB_OBJECTS)
	@$(CXX) -shared -Wl,-soname,$(LIB) -o $(LIB) $(LIB_OBJECTS) $(YAML_LINK) $(FMT_LINK)

# build the executable
$(EXE): $(LIB) $(SRC)
	@$(CXX) $(CXXFLAGS) -I$(INCDIR) -L. $(SRC) -o $(EXE) -l$(LIB_NAME)

all: $(LIB) $(EXE)

$(BUILDDIR)/%.o: $(SRCDIR)/%.cpp
	@mkdir -p $(@D)
	@$(CXX) $(CXXFLAGS) -I$(INCDIR) -c $< -o $@

install: $(LIB)
	@install -m 755 $(LIB) /usr/local/lib
	@ldconfig

uninstall:
	@rm -f /usr/local/lib/$(LIB)
	@ldconfig

clean:
	@rm -rf *.dSYM
	@rm -f $(EXE)
	@rm -f $(LIB)
	@rm -rf build/*
